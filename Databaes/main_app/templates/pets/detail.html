{% extends 'base.html' %}
{% block content %}

<h1>Pet Details</h1>

<div class="card">
    <div class="card-content">
        <span class="card-title">{{ pet.name }}</span>
        <p>Species: {{ pet.species }}</p>
        <p>Description: {{ pet.description|linebreaks }}</p>
        {% if pet.age > 0 %}
            <p>Age: {{ pet.age }}</p>
        {% else %}
            <p>Age: Baby</p>
        {% endif %}
        <p>Size: {{ pet.size }}</p>
        <p>Fixed?: {{ pet.fixed }}</p>
    </div>
    {% if user.is_authenticated %}
        <div class="card-action">
            <a href="{% url 'pets_update' pet.id %}">Edit</a>
            <a href="{% url 'pets_delete' pet.id %}">Delete</a>
        </div>
    {% endif %}
</div>

<!-- New Appt Form -->
{% if user.is_authenticated %}
    <h2>Schedule Appointment</h2>
    <form method="post" action="{% url 'schedule_appointment' pet.id %}">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit">Schedule</button>
    </form>
{% else %}
    <p>Please log in to schedule an appointment.</p>
{% endif %}
<!-- Existing Appts -->
{% if user.is_authenticated %}
    {% if appointments %}
        <h2>Existing Appointments</h2>
        <ul>
            {% for appointment in appointments %}
                <li>
                    <br>{{ appointment.user }} <br>
                    {{ appointment.date }} at {{ appointment.time }} 
                    <form method="post" action="{% url 'delete_appointment' pet.id appointment.id %}">
                        {% csrf_token %}
                        <button type="submit" style="color: white; background-color: red; border: none;">Delete</button>
                    </form>
                </li>
            {% endfor %}
        </ul>
    {% endif %}
{% else %}
    <p>Please log in to view existing appointments or schedule a new one.</p>
{% endif %}


{% for photo in pet.photo_set.all %}
    <img class="responsive-img card-panel" src="{{photo.url}}" alt="Pet Photo">
{% empty %}
    <div class="card-panel teal-text center-align">No Photos Uploaded</div>
{% endfor %}

{% if user.is_authenticated %}
    <form action="{% url 'add_photo' pet.id %}" enctype="multipart/form-data" method="POST" class="card-panel">
        {% csrf_token %}
        <input type="file" name="photo-file">
        <br><br>
        <button type="submit" class="btn">Upload Photo</button>
    </form>
{% else %}
    <p>Sign in to add a picture</p>
{% endif %}

{% endblock %}
